# abort script on any command that exits with a non zero value
set -e

# libjson-c
# avoids the dreaded message during compilation
# ./gen: error while loading shared libraries: libjson-c.so.2: cannot open shared object file: No such file or directory
git clone https://github.com/json-c/json-c.git
pushd json-c
  sh autogen.sh
  ./configure
  make
  make install prefix=$BOSH_INSTALL_TARGET
popd

# bind/named
curl -OL ftp://ftp.isc.org/isc/bind9/9.10.2/bind-9.10.2.tar.gz
tar xvzf bind-9.10.2.tar.gz
cd bind-9.10.2
# Need the -L to link at link-time, the -rpath to link at runtime
# downside is the link-path is hard-coded
./configure \
  CFLAGS="-L${BOSH_INSTALL_TARGET}/lib -Wl,-rpath=${BOSH_INSTALL_TARGET}/lib" \
  --prefix=$BOSH_INSTALL_TARGET \
  --localstatedir=/var/vcap/sys
make
make install

echo $BOSH_INSTALL_TARGET
