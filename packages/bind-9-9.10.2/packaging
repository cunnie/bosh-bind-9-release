# abort script on any command that exits with a non zero value
set -e

if [ -f /etc/redhat-release ]; then
  # install libjson0 for CentOS stemcells
  yum install -y json-c
elif [ -f /etc/lsb-release ]; then
  # install libjson0 for Ubuntu stemcells (not tested)
  apt-get install libjson0
fi

# Install KRB5 statically-linked
curl -OL ftp://ftp.isc.org/isc/bind9/9.10.2/bind-9.10.2.tar.gz
tar xvzf bind-9.10.2.tar.gz
cd bind-9.10.2
# CFLAGS
# -static static compilation to avoid deploy-time requirement to install
#    libraries via yum/apt-get. Need GSSAPI directory for headers
# -I /usr/include/gssapi to avoid error
#    configure: error: could not determine proper GSSAPI linkage
#    /bin/ld: cannot find -lgss
#    /bin/ld: cannot find -lkrb5
export CFLAGS='-static -I/usr/include/gssapi/ -L/usr/lib64 -lgssapi_krb5'
./configure \
  --prefix=${BOSH_INSTALL_TARGET} \
  --localstatedir=/var/vcap/sys
make
make install
